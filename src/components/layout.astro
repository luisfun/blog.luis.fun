---
import './global.css'
import { Icon } from 'astro-icon/components'
import Search from 'astro-pagefind/components/Search'
import FallbackImage from '../assets/luisfun.png'
import { SEARCH_ID, SITE_DESCRIPTION, SITE_TITLE } from '../consts'
import NewTab from './new-tab.astro'

type Props = {
  title?: string
  description?: string
  image?: ImageMetadata
}
const { title = SITE_TITLE, description = SITE_DESCRIPTION, image = FallbackImage } = Astro.props

const canonicalURL = new URL(Astro.url.pathname, Astro.site)
---

<!doctype html>
<html lang="ja">
	<head>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width,initial-scale=1" />
		<link rel="icon" type="image/svg+xml" href="/favicon.svg" />
		<link rel="sitemap" href="/sitemap-index.xml" />
		<link rel="alternate" type="application/rss+xml" title={SITE_TITLE} href={new URL('rss.xml', Astro.site)} />
		<link rel="canonical" href={canonicalURL} />
		<title>{title}</title>
		<meta name="title" content={title} />
		<meta name="description" content={description} />
		<meta property="og:type" content="website" />
		<meta property="og:url" content={Astro.url} />
		<meta property="og:title" content={title} />
		<meta property="og:description" content={description} />
		<meta property="og:image" content={new URL(image.src, Astro.url)} />
		<meta property="twitter:card" content="summary" />
	</head>
	<body>
		<header class="flex justify-between">
			<a href="/" class="flex">
				<Icon name="luisfun" class="logo-icon" />{SITE_TITLE}
			</a>
			<button type="button" onclick={`${SEARCH_ID}.showModal()`} class="search-button flex justify-between">
				<Icon name="mdi:search" class="search-icon" />
				<div class="search-label">検索</div><div></div>
			</button>
			<dialog id={SEARCH_ID} class="modal">
				<div class="modal-box">
					<Search className="pagefind" uiOptions={{ showImages: false, excerptLength: 20, debounceTimeoutMs: 100, showSubResults: true }} />
				</div>
				<form method="dialog" class="modal-backdrop">
					<button aria-label="閉じる"></button>
				</form>
			</dialog>
		</header>
		<main data-pagefind-body>
			<slot />
		</main>
		<footer class="flex">
			<a href="/privacy/">プライバシーポリシー</a>
			<button type="button" onclick={`${SEARCH_ID}.showModal()`} class="flex footer-search">
				<Icon name="mdi:search" class="footer-icon" />
			</button>
			<NewTab href="https://github.com/luisfun/blog.luis.fun" aria-label="GitHub" class="flex">
				<Icon name="simple-icons:github" class="footer-icon" />
			</NewTab>
		</footer>
	</body>
</html>

<style>
	body {
		width: 91.6667%;
		max-width: 64rem;
		margin: auto;
	}
	header {
		margin: 0 0 4rem;
		padding: 1rem 0;
		border-bottom: var(--border);
	}
	header a {
		color: var(--text-1);
	}
	.logo-icon {
		width: 2rem;
		height: auto;
		margin-right: .5rem;
		color: var(--mono-f);
		background: var(--mono-0);
		outline: var(--border);
		border-radius: 30.9017%;
	}
	.search-button {
		width: 5rem;
		height: 2rem;
		padding: 0 .5rem;
		background: var(--bg-2);
		outline: var(--border);
		border-radius: 9999px;
	}
	.search-icon {
		width: 1.25rem;
		height: auto;
	}
	.search-label {
		font-weight: bold;
		color: var(--text-2);
	}
	.modal {
    pointer-events: none;
		opacity: 0;
    position: fixed;
		display: grid;
    inset: 0;
    margin: 0;
		padding: 0;
		border: none;
		width: 100%;
		max-width: none;
		height: 100%;
		max-height: none;
    overscroll-behavior: contain;
    z-index: 999;
    color: inherit;
    background: transparent;
		backdrop-filter: blur(.25rem);
    overflow-y: hidden;
	}
	.modal[open] {
		pointer-events: auto;
		visibility: visible;
		opacity: 1;
	}
	.modal-box {
    grid-column-start: 1;
    grid-row-start: 1;
		width: calc(83.3333% - 4rem);
		max-width: 48rem;
		min-height: 15rem;
		max-height: calc(91.6667svh - 4rem);
		margin: 4.1667svh auto auto;
		padding: 2rem;
		background: var(--bg-2);
		border: var(--border);
		border-radius: 1rem;
    overflow-y: auto;
    overscroll-behavior: contain;
	}
	.modal-backdrop{
    grid-column-start: 1;
    grid-row-start: 1;
    z-index: -1;
    display: grid;
    align-self: stretch;
    justify-self: stretch;
    color: transparent;
	}
	footer {
		margin: 4rem 0 0;
		padding: 1rem 0;
		border-top: var(--border);
		text-align: center;
	}
	footer a, .footer-icon {
		color: var(--text-2);
	}
	.footer-search {
		margin: 0 1rem 0 auto;
	}
	.footer-icon {
		width: 1.25rem;
		height: auto;
	}
	.footer-search > .footer-icon {
		width: 1.5rem;
	}
</style>
