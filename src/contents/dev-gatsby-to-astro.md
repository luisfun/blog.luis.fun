---
emoji: twemoji:astronaut
title: ブログをGatsbyからAstroへ移行した話
description: ブログを再開するとき、GatsbyからAstroへ移行した技術的なメモ
created: 2025-08-20
---

3年ぶりのブログ再開にあたり、フレームワークの移行を行いました。

## Gatsbyの技術的負債を解消

初めに、Gatsbyのコントリビューターには感謝を述べたいです。

元々、WordPressで運用していたブログの運用コスト（レンタルサーバー代）が負担になっていたため、当時（5年前くらい）色々検索してGatsbyへ移行するのが良さそうだと判断しました。このとき、Cloudflare Pagesへデプロイし、運用コストをドメイン代のみに抑えれたのは非常にありがたかったです。

このブログの遷移をまとめると
```
WordPress
↓ 運用コストを改善
Gatsby
↓ 技術的負債を改善
Astro
```

### Gatsbyを負債に感じてしまった理由

- フレームワーク更新頻度の低下
  - v5.14（2024年11月）（現在の最新版）
  - v5.13（2023年12月）
- 依存関係に脆弱性を抱えている（その時の記憶）
- SPAである必要がない

#### 更新頻度の低下

[Gatsbyは2023年2月にNetlifyに買収されました](https://www.gatsbyjs.com/blog/gatsby-is-joining-netlify/)。私の邪推ですが、ここから1年以内に内部で何かがあり、Gatsbyのコアメンテナーがほぼいなくなってしまったんだと思います。Vercel+Next.jsの対抗になるように、Netlify+Gatsbyになってほしかったですが、非常に残念です。

また、現在のスターターキットでは、[エラーを吐いて動かない](https://qiita.com/u83unlimited/items/20a84b16a25039f1a067)こともあるようです。

#### 依存関係に脆弱性

私の記憶が正しければ、2023年2月の買収前のバージョンで、すでにいくつかの脆弱性が依存関係に内包されていたと思います。（もしかするとthemeによるものかもしれません）

ブログ程度であれば、クリティカルな脆弱性以外は大したことないと思いますが、利用者側としてあまり気持ちのいいものではありません。

#### SPAである必要がない

以前、別のツールサイトもGatsbyで作成していました。しかし、低速回線では、内部リンクのクリックが直ぐに反応しない事がありました。

原因の調査を行ったところ、初期ページの表示はHTMLが配信されるため、非常に高速です。しかし、別ページはJavaScriptで同時に配信されるため、ロード中は別ページへ飛ぶことができない状態でした。

この問題により、ツールサイトをSPAベースのGatsbyから、MPAベースのAstroへ移行した経緯があります。

また、個人ブログのようなサイトでは、ほとんどのユーザーが1ページで離脱します。わざわざ別ページの情報をJavaScriptでバンドルし、配信する必要はないのではないか？といった考えもあります。

## レイアウトを再デザイン

以前のレイアウト
- Gatsbyコミュニティーの[テーマ](https://www.gatsbyjs.com/plugins/@lekoarts/gatsby-theme-minimal-blog/)

新しいレイアウト
- [Zenn](https://zenn.dev/)を参考にした、自前CSS
- 投稿一覧・カテゴリ・タグを削除
  - [Pagefind](https://pagefind.app/)によるサイト内検索で代用

デザインについて、完全には満足していないです。（何かが違う気がする）

### 技術が絡むデザイン変更について

技術的なデザイン変更として、投稿一覧・カテゴリ・タグを一気に削除しました。

主な理由は

- /postsか/postとか/tagsか/tagで迷ったから
- サイトマップ汚染の軽減
- カテゴリ・タグの管理コスト軽減

デザイン変更を考えたとき、一番迷っていたのが「s」を付けるかどうかでした。一般的には「s」を付けるのが通例ですが、個人的に何となく違和感があり、迷っていました。そこで思いついたのが「いっそ/postsや/tagsを無くしてしまえばいいのでは？」という考えです。

投稿一覧・カテゴリ・タグを削除することで、サイトマップ汚染の軽減や、カテゴリ・タグの管理コスト軽減といった副作用もあり、個人運用であれば、むしろ良いことずくめかと思います。また、代用としてサイト内検索を用意すれば、巡回したい人の入口になると判断しました。

## CMSの利用（検討段階）

次のことを満たすため、APIベースのCMSではなく、GitベースのCMSを採用したいと考えていました。

- バックアップの容易性
- ベンダーロックインの回避
- ローカル編集を可能に

GitベースのCMSとして、次のものを候補としました。

- [tinaCMS](https://tina.io/)
- [Contentrain](https://contentrain.io/)
- [Decap CMS](https://decapcms.org/)

### tinaCMS（不採用）

最初に、tinaCMS+Astroのスターターキットで始めました。しかし、次の点で不採用になりました。

- スターターキット+MathJaxで数式を記述できない
  - 解消方法を探すのが面倒だった
- ベンダーロックインに近いにおいを感じた
  - 認証がTinaCloud
    - 自前で認証も可能だが、すぐに見つけられなかった
  - スターターキットだとtinaCMSの汚染度が高い
    - astroのみでdev・buildしずらそうだった
- スターターキットの時点で、依存関係にクリティカルな脆弱性が残る

依存関係にクリティカルな脆弱性が残るのは、技術的な負債の蓄積だと思うので回避することにしました。

### Contentrain（検討）

お手軽さがあり、かなり良さそうでしたが雲行きが怪しいです。

- コミュニティーがほぼ死んでる
  - Contentain 2.0が完了した？あたりから中の人の発信が途絶えてる
    - [ブログ](https://contentrain.io/resources/blog)・[X](https://x.com/Contentrain_io)で1年間発信がない
    - Discordは1年間で1回反応があった
- Contentrainが死ぬとエディタが死ぬ
  - プロジェクトファイルへのContentrainの汚染度は低い
    - ローカル編集は問題なく機能する

現在、Discordで質問を投げているところです。反応がなければ、不採用になりそうです。

### Decap CMS（検討）

基本的には、疎なtinaCMSだと思います。まだ試していないので分かりませんが、認証の自前用Exampleはありました。

### CMSなんてなかった（現在）

現在、VSCodeでローカル編集をしています。正直言うと特段困っていることはないです。むしろ、Github Copilot Chatを手軽に利用できて、楽な部分もある気がします。

「どうしてもCMSが必要」とか「スマホで編集したい」とかが無ければ、このままVSCodeで編集してもいいかなと思っています。
